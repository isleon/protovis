<!DOCTYPE html>
<html>
  <head>
    <title>Sunburst</title>
    <meta charset="utf-8">
    <script type="text/javascript" src="keymap.js"></script>
    <style type="text/css">

#fig {
  width: 900px;
  margin-top: 5px;
  height: 900px;
  text-align: center;
}

text {
  font-size: 18px
}

    </style>
  </head>
  <body><div id="container"></div>
    <script>

var data = [
  {value:1, color:'red'}, 
  {value:2, color:'green'}, 
  {value:3, color:'blue'}, 
  {value:4, color:'orange'}, 
]

// 计算每个节点的角度和起始角度
var sum = data.reduce(function(s, d){ return s+d.value }, 0)
data.forEach(function(d, i) {d.angle = (Math.PI *2) * d.value/sum})
data.reduce(function(s, d){
    d.startAngle = s
    d.endAngle = d.startAngle + d.angle
    return d.endAngle
}, 0)

var size = 200

function create (type) { 
  return document.createElementNS(svgns, type);
}

function pieChart() {
    var svgns = "http://www.w3.org/2000/svg";
    var chart = document.createElementNS(svgns, "svg");
    chart.setAttribute("width", size);
    chart.setAttribute("height", size);
    chart.setAttribute("viewBox", "0 0 " + size + " " + size);

    // Background circle
    var back = document.createElementNS(svgns, "circle");
    back.setAttribute("cx", size / 2);
    back.setAttribute("cy", size / 2);
    back.setAttribute("r",  size / 2);

    var color = "#d0d0d0";
    back.setAttribute("fill", color);
    chart.appendChild(back);

    for (var i=0; i<data.length; i++) {
        var d = data[i]
        // primary wedge
        var path = document.createElementNS(svgns, "path");
        var startAngle = d.startAngle;
        var endAngle = d.endAngle;
        var x1 = (size / 2) + (size / 2) * Math.sin(startAngle);
        var y1 = (size / 2) - (size / 2) * Math.cos(startAngle);
        var x2 = (size / 2) + (size / 2) * Math.sin(endAngle);
        var y2 = (size / 2) - (size / 2) * Math.cos(endAngle);
        var big = (endAngle - startAngle > Math.PI) ? 1 : 0;

        var dd = "M " + (size / 2) + "," + (size / 2) +  // Start at circle center
            " L " + x1 + "," + y1 +     // Draw line to (x1,y1)
            " A " + (size / 2) + "," + (size / 2) +       // Draw an arc of radius r
            " 0 " + big + " 1 " +       // Arc details...
            x2 + "," + y2 +             // Arc goes to to (x2,y2)
            " Z";                       // Close path back to (cx,cy)
        path.setAttribute("d", dd); // Set this path 
        path.setAttribute("fill", d.color);
        path.setAttribute("stroke", "rgb(255,255,255)")
        chart.appendChild(path); // Add wedge to chart
    };

    // foreground circle
    var front = document.createElementNS(svgns, "circle");
    front.setAttribute("cx", (size / 2));
    front.setAttribute("cy", (size / 2));
    front.setAttribute("r",  (size * 0.17)); //about 34% as big as back circle 
    front.setAttribute("fill", "#fff");
    chart.appendChild(front);
    return chart;
}

var c = document.getElementById('container');
c.appendChild( pieChart() );

    </script></body>
</html>
